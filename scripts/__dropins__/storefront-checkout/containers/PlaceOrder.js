/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as a}from"@dropins/tools/preact-jsx-runtime.js";/* empty css                  */import{Button as E}from"@dropins/tools/components.js";import{classes as S,Slot as P}from"@dropins/tools/lib.js";import{w as y}from"../chunks/withConditionalRendering.js";import{s as b}from"../chunks/state.js";import{c as U,b as I,a as w,d}from"../chunks/transform-store-config.js";import{U as N}from"../chunks/errors.js";import{events as T}from"@dropins/tools/event-bus.js";import{useState as z,useCallback as l,useEffect as D}from"@dropins/tools/preact-hooks.js";import{useText as H,Text as _}from"@dropins/tools/i18n.js";import"@dropins/tools/fetch-graphql.js";import"../chunks/store-config.js";import"@dropins/tools/signals.js";const j=({children:t,className:o,disabled:n=!1,onClick:r})=>a("div",{className:S(["checkout-place-order",o]),children:a(E,{className:"checkout-place-order__button","data-testid":"place-order-button",disabled:n,onClick:r,size:"medium",type:"submit",variant:"primary",children:t},"placeOrder")}),B=t=>t instanceof TypeError||t instanceof N,u=({disabled:t=!1,handleValidation:o,handlePlaceOrder:n,slots:r,...p})=>{const[f,C]=z(!1),{data:O,pending:k}=U.value,g=I.value.pending,h=!!O,s=H({CheckoutUnexpectedError:"Checkout.ServerError.unexpected"}),i=l(e=>{w.value=B(e)?s.CheckoutUnexpectedError:e.message},[s]),v=l(async()=>{try{if(!(o?o():!0))return;await n({cartId:b.cartId||"",code:d.value||""})}catch(e){i(e)}},[o,n,i]);return D(()=>{const e=T.on("cart/initialized",c=>{const x=(c==null?void 0:c.items)||[];C(x.some(m=>m.outOfStock||m.insufficientQuantity))},{eager:!0});return()=>{e==null||e.off()}},[]),a(j,{...p,onClick:v,disabled:t||!h||k||f||g,children:r!=null&&r.Content?a(P,{name:"Content",slot:r.Content,context:{code:d.value||""}}):a(_,{id:"Checkout.PlaceOrder.button"})})};u.displayName="PlaceOrderContainer";const Z=y(u);export{Z as PlaceOrder,Z as default};

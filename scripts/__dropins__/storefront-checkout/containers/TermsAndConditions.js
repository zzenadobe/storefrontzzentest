/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as e,jsxs as E}from"@dropins/tools/preact-jsx-runtime.js";/* empty css                             */import{Skeleton as N,SkeletonRow as w,Checkbox as j}from"@dropins/tools/components.js";import{p as y}from"../chunks/TermsAndConditions.js";import{classes as k,VComponent as D,Slot as H}from"@dropins/tools/lib.js";/* empty css                      *//* empty css                  *//* empty css                       */import{A as P}from"../chunks/checkout.js";import{events as p}from"@dropins/tools/event-bus.js";import{s as R}from"../chunks/state.js";import{useState as i,useCallback as g,useEffect as A}from"@dropins/tools/preact-hooks.js";import{useText as V,MarkupText as $}from"@dropins/tools/i18n.js";const q=({html:n})=>{const r=y.sanitize(n,{ADD_ATTR:["target"]});return r===""?null:e("span",{dangerouslySetInnerHTML:{__html:r}})},L=({className:n,agreements:r,error:s,isInitialized:a=!1,...c})=>a?e("div",{className:"checkout-terms-and-conditions","data-testid":"checkout-terms-and-conditions",children:E("form",{...c,className:k(["checkout-terms-and-conditions__form",n]),name:"checkout-terms-and-conditions__form","data-testid":"checkout-terms-and-conditions-form",noValidate:!0,children:[r&&e(D,{node:r,className:k(["checkout-terms-and-conditions__agreements"]),"data-testid":"checkout-terms-and-conditions-agreements"}),s&&e("div",{className:"checkout-terms-and-conditions__error","data-testid":"checkout-terms-and-conditions-error",children:s})]})}):e(O,{}),O=()=>e(N,{"data-testid":"checkout-terms-and-conditions-skeleton",className:"checkout-terms-and-conditions-skeleton",children:e(w,{variant:"row",size:"small",fullWidth:!0})}),ne=({slots:n,...r})=>{const[s,a]=i(!0),[c,_]=i(!1),[C,T]=i(!1),[x,m]=i(""),{errorMessage:l}=V({errorMessage:"Checkout.TermsAndConditions.error"}),I=g(()=>{m("")},[]),v=g(()=>{m(l)},[l]);return A(()=>{const t=p.on("checkout/initialized",()=>{var o;_(!0),a(((o=R.config)==null?void 0:o.isCheckoutAgreementsEnabled)??!0)},{eager:!0});return()=>{t==null||t.off()}},[]),A(()=>{const t=p.on("authenticated",o=>{T(o)},{eager:!0});return()=>{t==null||t.off()}},[]),!s||C?null:e(L,{...r,error:x,isInitialized:c,agreements:e(H,{name:"Agreements",slot:n==null?void 0:n.Agreements,context:{appendAgreement(t){this._registerMethod((...o)=>{const u=t(...o);if(!u)return;const{mode:M,name:h,text:d,translationId:f}=u;if(!d&&!f){console.warn(`The agreement ${h} is misconfigured. Please provide a text or a translationId.`);return}const b=d?e(q,{html:d}):e($,{id:f}),S=e(j,{checked:M===P.AUTO,label:b,name:h,required:!0,onChange:I,onInvalid:v});this._setProps(z=>({children:[...z.children||[],S]}))})}}})})};export{ne as TermsAndConditions,ne as default};
